{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "$id": "https://auvima.io/schemas/exploration_session.schema.json",
  "title": "ExplorationSession",
  "description": "交互式探索过程的记录，用于生成配方脚本",
  "type": "object",
  "properties": {
    "session_id": {
      "type": "string",
      "format": "uuid",
      "description": "会话唯一ID（UUID格式）"
    },
    "user_description": {
      "type": "string",
      "description": "用户原始需求描述",
      "examples": ["在YouTube视频页面提取完整字幕内容"]
    },
    "target_url": {
      "type": "string",
      "format": "uri",
      "description": "探索的目标页面URL"
    },
    "steps": {
      "type": "array",
      "description": "探索步骤序列",
      "items": {
        "$ref": "exploration_step.schema.json"
      },
      "minItems": 1
    },
    "created_at": {
      "type": "string",
      "format": "date-time",
      "description": "会话开始时间（ISO 8601格式）"
    },
    "completed_at": {
      "type": "string",
      "format": "date-time",
      "description": "会话完成时间（ISO 8601格式，可选）"
    },
    "status": {
      "type": "string",
      "enum": ["initializing", "in_progress", "waiting_user", "completed", "failed", "cancelled"],
      "description": "会话状态"
    },
    "interaction_count": {
      "type": "integer",
      "minimum": 0,
      "maximum": 3,
      "description": "用户交互次数（不超过3次）"
    },
    "generated_recipe_name": {
      "type": "string",
      "pattern": "^[a-z0-9_]+$",
      "description": "生成的配方名称（可选）"
    }
  },
  "required": [
    "session_id",
    "user_description",
    "target_url",
    "steps",
    "created_at",
    "status",
    "interaction_count"
  ],
  "additionalProperties": false,
  "if": {
    "properties": {
      "status": {
        "const": "completed"
      }
    }
  },
  "then": {
    "required": ["completed_at", "generated_recipe_name"]
  }
}
