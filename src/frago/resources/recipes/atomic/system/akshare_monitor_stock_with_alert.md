---
name: akshare_monitor_stock_with_alert
type: atomic
runtime: python
description: "æŒç»­ç›‘æ§è‚¡ç¥¨ä»·æ ¼å¹¶åœ¨å¼‚å¸¸æ³¢åŠ¨æ—¶å‘Šè­¦ï¼ˆæ”¯æŒè‡ªå®šä¹‰é˜ˆå€¼å’Œç›‘æ§æ—¶é•¿ï¼‰"
use_cases:
  - "å®æ—¶ç›‘æ§é‡ç‚¹å…³æ³¨è‚¡ç¥¨çš„å¼‚å¸¸æ³¢åŠ¨"
  - "è§¦å‘ä»·æ ¼å‘Šè­¦æ—¶æ‰§è¡Œåç»­æ“ä½œï¼ˆå¦‚å‘é€é€šçŸ¥ï¼‰"
  - "è®°å½•å®Œæ•´çš„ä»·æ ¼å˜åŒ–å†å²ä¾›äº‹ååˆ†æ"
tags:
  - stock
  - akshare
  - monitoring
  - alert
  - realtime
output_targets:
  - stdout
  - file
inputs:
  symbol:
    type: string
    required: true
    description: "Aè‚¡è‚¡ç¥¨ä»£ç ï¼ˆ6ä½æ•°å­—ï¼‰"
  interval:
    type: number
    required: false
    description: "è½®è¯¢é—´éš”ï¼ˆç§’ï¼‰ï¼Œé»˜è®¤60"
  duration:
    type: number
    required: false
    description: "ç›‘æ§æ—¶é•¿ï¼ˆç§’ï¼‰ï¼Œé»˜è®¤300ï¼ˆ5åˆ†é’Ÿï¼‰"
  output_dir:
    type: string
    required: false
    description: "è¾“å‡ºç›®å½•ï¼Œé»˜è®¤ 'outputs'"
  alert_change_pct:
    type: number
    required: false
    description: "æ¶¨è·Œå¹…å‘Šè­¦é˜ˆå€¼ï¼ˆ%ï¼‰ï¼Œé»˜è®¤3.0"
  alert_amplitude:
    type: number
    required: false
    description: "æŒ¯å¹…å‘Šè­¦é˜ˆå€¼ï¼ˆ%ï¼‰ï¼Œé»˜è®¤8.0"
outputs:
  data:
    type: object
    description: "åŒ…å«ç›‘æ§æ‘˜è¦ã€å‘Šè­¦è®°å½•å’Œæ•°æ®æ–‡ä»¶è·¯å¾„"
dependencies: []
version: "1.0.0"
---

# akshare_monitor_stock_with_alert

## åŠŸèƒ½æè¿°

æŒç»­ç›‘æ§æŒ‡å®šè‚¡ç¥¨çš„ä»·æ ¼å˜åŒ–ï¼Œå¹¶åœ¨è§¦å‘å‘Šè­¦æ¡ä»¶æ—¶ï¼š
1. **è®°å½•å‘Šè­¦**: ä¿å­˜å‘Šè­¦è¯¦æƒ…åˆ° JSON æ–‡ä»¶
2. **æŒä¹…åŒ–æ•°æ®**: æ‰€æœ‰é‡‡æ ·æ•°æ®ä¿å­˜åˆ° JSONL æ–‡ä»¶
3. **å®æ—¶è¾“å‡º**: åœ¨ stderr æ˜¾ç¤ºå®æ—¶çŠ¶æ€ï¼Œstdout è¾“å‡ºæœ€ç»ˆç»“æœ
4. **è‡ªåŠ¨é‡è¯•**: ç½‘ç»œå¤±è´¥è‡ªåŠ¨é‡è¯•3æ¬¡

**å‘Šè­¦æ¡ä»¶**ï¼š
- æ¶¨è·Œå¹…è¶…è¿‡é˜ˆå€¼ï¼ˆé»˜è®¤Â±3%ï¼‰
- æŒ¯å¹…è¶…è¿‡é˜ˆå€¼ï¼ˆé»˜è®¤8%ï¼‰

é€‚ç”¨äºéœ€è¦å®æ—¶ç›‘æ§è‚¡ä»·å¼‚å¸¸æ³¢åŠ¨çš„åœºæ™¯ï¼Œå¯é›†æˆåˆ°æ›´å¤æ‚çš„ç›‘æ§å’Œé€šçŸ¥ç³»ç»Ÿä¸­ã€‚

## ä½¿ç”¨æ–¹æ³•

**åŸºç¡€ç›‘æ§**ï¼ˆé»˜è®¤5åˆ†é’Ÿï¼Œ60ç§’é—´éš”ï¼‰ï¼š
```bash
uv run frago recipe run akshare_monitor_stock_with_alert \
  --params '{"symbol": "000001"}'
```

**è‡ªå®šä¹‰å‚æ•°**ï¼š
```bash
uv run frago recipe run akshare_monitor_stock_with_alert \
  --params '{
    "symbol": "000001",
    "interval": 30,
    "duration": 1800,
    "alert_change_pct": 2.0,
    "alert_amplitude": 5.0,
    "output_dir": "my_monitoring"
  }' \
  --output-file monitoring_result.json
```

**åå°è¿è¡Œ**ï¼ˆé•¿æ—¶é—´ç›‘æ§ï¼‰ï¼š
```bash
nohup uv run frago recipe run akshare_monitor_stock_with_alert \
  --params '{"symbol": "000001", "duration": 14400}' \
  > monitor.log 2>&1 &
```

## å‰ç½®æ¡ä»¶

- å·²å®‰è£…ä¾èµ–: `uv pip install akshare pandas`
- ç½‘ç»œç¨³å®šï¼ˆéœ€æŒç»­è®¿é—®APIï¼‰
- åœ¨äº¤æ˜“æ—¶é—´æ‰§è¡Œï¼ˆéäº¤æ˜“æ—¶é—´æ— æ•°æ®ï¼‰

## é¢„æœŸè¾“å‡º

### å®æ—¶è¾“å‡ºï¼ˆstderrï¼‰

```
ğŸš€ å¼€å§‹ç›‘æ§è‚¡ç¥¨ 000001
â°è½®è¯¢é—´éš”: 60ç§’
â±ï¸  ç›‘æ§æ—¶é•¿: 300ç§’
ğŸ“ æ•°æ®æ–‡ä»¶: outputs/monitor_000001_20251124_153000.jsonl
ğŸ”” å‘Šè­¦é˜ˆå€¼: æ¶¨è·Œå¹…Â±3.0%, æŒ¯å¹…>8.0%
============================================================
âœ… [1] 2025-11-24 15:30:00 | ä»·æ ¼: Â¥12.58 | æ¶¨è·Œ: +2.35% | æˆäº¤é‡: 152,345
âœ… [2] 2025-11-24 15:31:00 | ä»·æ ¼: Â¥12.62 | æ¶¨è·Œ: +2.68% | æˆäº¤é‡: 168,234
âš ï¸  [3] å‘Šè­¦: æ¶¨è·Œå¹… +3.20% è¶…è¿‡é˜ˆå€¼ Â±3.0%
âœ… [3] 2025-11-24 15:32:00 | ä»·æ ¼: Â¥12.70 | æ¶¨è·Œ: +3.20% | æˆäº¤é‡: 185,672
...
============================================================
ğŸ“Š ç›‘æ§ç»“æŸ
â±ï¸  æ€»è€—æ—¶: 300ç§’
ğŸ“ é‡‡é›†æ¬¡æ•°: 5æ¬¡
ğŸ”” å‘Šè­¦æ¬¡æ•°: 1æ¬¡
```

### æœ€ç»ˆç»“æœï¼ˆstdout JSONï¼‰

```json
{
  "success": true,
  "data": {
    "symbol": "000001",
    "start_time": "2025-11-24 15:30:00",
    "end_time": "2025-11-24 15:35:00",
    "duration_seconds": 300,
    "interval_seconds": 60,
    "total_samples": 5,
    "alert_count": 1,
    "alerts": [
      {
        "symbol": "000001",
        "timestamp": "2025-11-24 15:32:00",
        "alert": {
          "type": "price_change",
          "message": "æ¶¨è·Œå¹… +3.20% è¶…è¿‡é˜ˆå€¼ Â±3.0%",
          "severity": "high"
        },
        "data": {
          "price": 12.70,
          "change_pct": 3.20,
          ...
        }
      }
    ],
    "data_file": "outputs/monitor_000001_20251124_153000.jsonl",
    "alert_dir": "outputs/alerts"
  }
}
```

### ç”Ÿæˆçš„æ–‡ä»¶

1. **æ•°æ®æ–‡ä»¶**ï¼ˆJSONLæ ¼å¼ï¼‰: `outputs/monitor_<symbol>_<timestamp>.jsonl`
   ```jsonl
   {"symbol":"000001","timestamp":"2025-11-24 15:30:00","price":12.58,...}
   {"symbol":"000001","timestamp":"2025-11-24 15:31:00","price":12.62,...}
   ```

2. **å‘Šè­¦æ–‡ä»¶**ï¼ˆJSONæ ¼å¼ï¼‰: `outputs/alerts/alert_<symbol>_<timestamp>.json`
   ```json
   {
     "symbol": "000001",
     "timestamp": "2025-11-24 15:32:00",
     "alert": {...},
     "data": {...}
   }
   ```

## æ³¨æ„äº‹é¡¹

- **é•¿æ—¶é—´è¿è¡Œ**: è®¾ç½®è¾ƒé•¿çš„ `duration` æ—¶å»ºè®®åå°è¿è¡Œï¼ˆnohup/screen/tmuxï¼‰
- **ç£ç›˜ç©ºé—´**: JSONL æ–‡ä»¶ä¼šæŒç»­å¢é•¿ï¼Œæ³¨æ„ç£ç›˜ç©ºé—´ï¼ˆæ¯æ¬¡é‡‡æ ·çº¦200å­—èŠ‚ï¼‰
- **APIé™æµ**: ä¸å»ºè®® `interval` è®¾ç½®è¿‡å°ï¼ˆ<10ç§’ï¼‰ï¼Œå¯èƒ½è¢«é™æµ
- **äº¤æ˜“æ—¶é—´**: éäº¤æ˜“æ—¶é—´æ— æ³•è·å–æ•°æ®ï¼Œç›‘æ§ä¼šå¤±è´¥
- **ç½‘ç»œç¨³å®šæ€§**: è¿ç»­3æ¬¡å¤±è´¥ä¼šè¾“å‡ºè­¦å‘Šï¼Œä½†ä¸ä¼šä¸­æ­¢ç›‘æ§
- **å‘Šè­¦çµæ•åº¦**:
  - `alert_change_pct` è®¾ç½®å¤ªå°ï¼ˆå¦‚0.5%ï¼‰ä¼šé¢‘ç¹å‘Šè­¦
  - `alert_amplitude` å¯¹æ³¢åŠ¨è¾ƒå¤§çš„è‚¡ç¥¨å¯èƒ½é¢‘ç¹è§¦å‘

## æ›´æ–°å†å²

| æ—¥æœŸ | ç‰ˆæœ¬ | å˜æ›´è¯´æ˜ |
|------|------|----------|
| 2025-11-24 | v1.0.0 | åˆå§‹ç‰ˆæœ¬ï¼Œæ”¯æŒè‡ªå®šä¹‰é˜ˆå€¼å’Œè‡ªåŠ¨é‡è¯• |
