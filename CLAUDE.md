# Frago Development Guidelines

## Document Maintenance Principles

```python
# Language Policy
if task in [coding, docs, comments]:
    lang = "English"
else:  # conversation, explanation, Q&A
    lang = "Chinese"

if lang == "Chinese" and file_type == "doc":
    filename = f"{name}-zhCN.md"  # e.g., README-zhCN.md

# This File Scope
CLAUDE_MD.includes = [
    "project_directory_structure",
    "resource_update_workflow",
    "prohibited_operations",
    "technical_preferences",
]

CLAUDE_MD.excludes = [
    "frago_product_usage_instructions",
    "command_reference",
    "api_documentation",
    "agent_behavioral_specs",  # see ~/.claude/commands/frago/
    "version_numbers",         # see pyproject.toml
    "dependency_lists",        # see pyproject.toml
]
```

## Directory Structure

```python
PROJECT_STRUCTURE = {
    "src/frago/":           "Core code",
    "src/frago/resources/": "PyPI package resources (generated by dev pack)",
}
```

## Target Audience

```python
class TargetUser:
    types = ["developers", "automation_seekers"]

class Developer(TargetUser):
    """Enjoys technical research, API docs, experimental development"""

class AutomationSeeker(TargetUser):
    """Limited technical experience, needs guidance on solutions"""

# Documentation Principles
def write_docs(content):
    assert is_comprehensive(content), "Provide sufficient help"
    assert is_accessible(content), "Easy to understand"
    assert provides_best_choice(content), "Not 'Option 1 vs Option 2'"
    assert user_friendly(content), "Based on 'can users easily understand this'"
```

## Cross-Platform Development

```python
SUPPORTED_PLATFORMS = ["Linux", "macOS", "Windows"]
MOST_QUIRKY = "Windows"

# --- Command Line Arguments ---
# Windows truncates args at newlines

# WRONG
subprocess.run(["claude", "-p", multi_line_prompt])

# CORRECT: use stdin
process = subprocess.Popen(["claude", "-p", "-"], stdin=subprocess.PIPE)
process.stdin.write(prompt.encode())
process.stdin.close()

# CORRECT: use temp file
prompt_file.write_text(prompt)
subprocess.run(["frago", "agent", "--prompt-file", str(prompt_file)])

# --- Path Encoding ---
# Claude Code encodes project paths as directory names
# Windows ':' → '-', producing double hyphen
PATH_ENCODING = {
    "/home/user/project": "-home-user-project",
    "C:\\Users\\yammi":   "C--Users-yammi",
}
# See: frago/session/sync.py → encode_project_path, decode_project_path

# --- subprocess Calls ---
from frago.compat import prepare_command_for_windows

# Automatically resolves full path to claude.CMD
subprocess.run(prepare_command_for_windows(["claude", "-p", "test"]))

# --- Encoding Issues ---
# Windows console defaults to non-UTF-8
subprocess.run(cmd, text=True, encoding='utf-8')

# --- Null Device ---
# PROHIBITED: hardcoding '/dev/null' (creates actual file on Windows)

# CORRECT:
NULL_DEVICE = 'nul' if platform.system() == 'Windows' else '/dev/null'

# BETTER:
subprocess.run(cmd, stdout=subprocess.DEVNULL, stderr=subprocess.DEVNULL)
```

## Resources Location

```python
USER_RESOURCES = {
    "~/.claude/": {
        "commands/": {
            "frago.*.md":  "Frago commands",
            "frago/":      "Command rules and scripts",
        },
        "skills/": {
            "frago-*/":    "Frago skills",
        },
    },
    "~/.frago/": {
        "config.json":     "Global configuration",
        "current_run":     "Current run context",
        "projects/":       "Run instance directory",
        "recipes/": {
            "atomic/":     "Atomic recipes",
            "workflows/":  "Workflow recipes",
        },
        "sessions/":       "Session storage",
        "chrome_profile/": "Chrome configuration",
    },
}
```

## Resource Update Workflow

```python
def dev_pack():
    sources = [
        "~/.claude/commands/frago.*.md",
        "~/.claude/skills/frago-*",
        "~/.frago/recipes/",
    ]
    target = "src/frago/resources/"

    for src in sources:
        sync(src, target)

# Usage: frago dev pack
```

## Prohibited Actions

```python
def modify_resources():
    if path.startswith("src/frago/resources/"):
        raise ProhibitedError("Auto-generated by dev pack")

    # CORRECT: Edit source, then sync
    edit("~/.claude/*")
    edit("~/.frago/*")
    run("frago dev pack")
```

## Documentation Index

```python
DOCS = {
    "docs/concepts.md":             "Core concepts and architecture design",
    "pyproject.toml":               "Dependency versions, entry point configuration",
    "specs/*/spec.md":              "Specifications for each feature",
    "~/.claude/commands/frago/":    "Behavioral specifications for Agents using frago",
}
# Read as needed
```

## Active Technologies
- Python 3.9+ (existing project requirement) + FastAPI, Uvicorn (new), existing React/TypeScript frontend (013-change-gui-into-web-service)
- N/A (uses existing session storage in `~/.frago/sessions/`) (013-change-gui-into-web-service)
- Python 3.9+ (backend), TypeScript/React 18 (frontend) + FastAPI, Uvicorn, Click (backend); React, Zustand, Tailwind CSS, Vite (frontend) (014-server-background-redesign)
- File-based (existing `~/.frago/` directory structure) (014-server-background-redesign)

## Recent Changes
- 013-change-gui-into-web-service: Added Python 3.9+ (existing project requirement) + FastAPI, Uvicorn (new), existing React/TypeScript frontend
