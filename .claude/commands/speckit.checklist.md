---
description: 根据用户需求为当前功能生成自定义检查清单。
---

## 检查清单的目的:"需求编写的单元测试"

**核心概念**:检查清单是**需求编写的单元测试** - 它们验证特定领域需求的质量、清晰度和完整性。

**不是用于验证/测试**:

- ❌ 不是"验证按钮点击是否正确"
- ❌ 不是"测试错误处理是否工作"
- ❌ 不是"确认API返回200"
- ❌ 不是检查代码/实现是否符合规格

**用于需求质量验证**:

- ✅ "是否为所有卡片类型定义了视觉层次需求?"(完整性)
- ✅ "'突出显示'是否用具体的尺寸/定位进行了量化?"(清晰度)
- ✅ "所有交互元素的悬停状态需求是否一致?"(一致性)
- ✅ "是否为键盘导航定义了无障碍需求?"(覆盖范围)
- ✅ "规格是否定义了logo图片加载失败时会发生什么?"(边界情况)

**比喻**:如果你的规格是用英语编写的代码,那么检查清单就是它的单元测试套件。你在测试需求是否编写良好、完整、无歧义且可供实现 - 而不是测试实现是否有效。

## 用户输入

```text
$ARGUMENTS
```

你**必须**在继续之前考虑用户输入(如果不为空)。你应该全程使用中文来撰写所有文档内容或代码注释。

## 执行步骤

1. **设置**:从仓库根目录运行 `.specify/scripts/bash/check-prerequisites.sh --json` 并解析JSON以获取FEATURE_DIR和AVAILABLE_DOCS列表。
   - 所有文件路径必须是绝对路径。
   - 对于参数中的单引号,如"I'm Groot",使用转义语法:例如 'I'\''m Groot'(或如果可能使用双引号:"I'm Groot")。

2. **澄清意图(动态)**:推导最多三个初始的上下文澄清问题(不使用预设目录)。它们必须:
   - 从用户的措辞 + 从规格/计划/任务中提取的信号生成
   - 仅询问会实质性改变检查清单内容的信息
   - 如果在`$ARGUMENTS`中已经明确,则单独跳过
   - 优先考虑精确性而非广度

   生成算法:
   1. 提取信号:功能领域关键词(例如,认证、延迟、UX、API)、风险指标("关键"、"必须"、"合规")、利益相关者提示("QA"、"审查"、"安全团队")以及明确的交付物("无障碍"、"回滚"、"契约")。
   2. 将信号聚类到候选焦点区域(最多4个),按相关性排序。
   3. 识别可能的受众和时间(作者、审查者、QA、发布),如果不明确。
   4. 检测缺失的维度:范围广度、深度/严格性、风险重点、排除边界、可衡量的验收标准。
   5. 从以下原型中选择问题:
      - 范围细化(例如,"这应该包括与X和Y的集成接触点还是仅限于本地模块正确性?")
      - 风险优先级(例如,"这些潜在风险区域中哪些应该接受强制性门控检查?")
      - 深度校准(例如,"这是轻量级的提交前健全性列表还是正式的发布门控?")
      - 受众框架(例如,"这将仅由作者使用还是在PR审查期间由同行使用?")
      - 边界排除(例如,"这一轮应该明确排除性能调优项目吗?")
      - 场景类别缺口(例如,"未检测到恢复流程 - 回滚/部分失败路径是否在范围内?")

   问题格式规则:
   - 如果呈现选项,生成一个紧凑的表格,列:选项 | 候选 | 重要性
   - 最多A-E选项;如果自由形式答案更清晰则省略表格
   - 永远不要要求用户重述他们已经说过的话
   - 避免推测性类别(不要虚构)。如果不确定,明确询问:"确认X是否属于范围。"

   无法互动时的默认值:
   - 深度:标准
   - 受众:如果与代码相关则为审查者(PR);否则为作者
   - 焦点:前2个相关性集群

   输出问题(标记Q1/Q2/Q3)。答案后:如果≥2个场景类别(备选/异常/恢复/非功能域)仍不清楚,你可以提出最多两个更有针对性的后续问题(Q4/Q5),每个都有一行理由(例如,"未解决的恢复路径风险")。不要超过五个总问题。如果用户明确拒绝更多,则跳过升级。

3. **理解用户请求**:结合`$ARGUMENTS` + 澄清答案:
   - 推导检查清单主题(例如,安全、审查、部署、用户体验)
   - 整合用户提到的明确必备项目
   - 将焦点选择映射到类别框架
   - 从规格/计划/任务推断任何缺失的上下文(不要虚构)

4. **加载功能上下文**:从FEATURE_DIR读取:
   - spec.md:功能需求和范围
   - plan.md(如果存在):技术细节、依赖项
   - tasks.md(如果存在):实现任务

   **上下文加载策略**:
   - 仅加载与活动焦点区域相关的必要部分(避免完整文件转储)
   - 优先将长节摘要为简洁的场景/需求要点
   - 使用渐进式披露:仅在检测到缺口时添加后续检索
   - 如果源文档很大,生成中期摘要项而不是嵌入原始文本

5. **生成检查清单** - 创建"需求的单元测试":
   - 如果不存在则创建`FEATURE_DIR/checklists/`目录
   - 生成唯一的检查清单文件名:
     - 使用基于领域的简短描述性名称(例如,`ux.md`、`api.md`、`security.md`)
     - 格式:`[领域].md`
     - 如果文件存在,则追加到现有文件
   - 从CHK001开始顺序编号项目
   - 每次`/speckit.checklist`运行都会创建一个新文件(永远不会覆盖现有检查清单)

   **核心原则 - 测试需求,而不是实现**:
   每个检查清单项目必须评估需求本身的:
   - **完整性**:是否存在所有必要的需求?
   - **清晰度**:需求是否明确且具体?
   - **一致性**:需求是否相互一致?
   - **可衡量性**:需求是否可以客观验证?
   - **覆盖范围**:是否涵盖所有场景/边界情况?

   **类别结构** - 按需求质量维度分组项目:
   - **需求完整性**(是否记录了所有必要的需求?)
   - **需求清晰度**(需求是否具体且无歧义?)
   - **需求一致性**(需求是否一致且无冲突?)
   - **验收标准质量**(成功标准是否可衡量?)
   - **场景覆盖范围**(是否涵盖所有流程/情况?)
   - **边界情况覆盖范围**(是否定义了边界条件?)
   - **非功能性需求**(性能、安全性、无障碍性等 - 是否已指定?)
   - **依赖项和假设**(是否记录和验证?)
   - **歧义和冲突**(需要澄清什么?)

   **如何编写检查清单项目 - "英语的单元测试"**:

   ❌ **错误**(测试实现):
   - "验证登陆页面显示3个剧集卡片"
   - "测试桌面上的悬停状态是否工作"
   - "确认logo点击导航到主页"

   ✅ **正确**(测试需求质量):
   - "是否指定了精选剧集的确切数量和布局?"[完整性]
   - "'突出显示'是否用具体的尺寸/定位进行了量化?"[清晰度]
   - "所有交互元素的悬停状态需求是否一致?"[一致性]
   - "是否为所有交互UI定义了键盘导航需求?"[覆盖范围]
   - "是否指定了logo图片加载失败时的回退行为?"[边界情况]
   - "是否为异步剧集数据定义了加载状态?"[完整性]
   - "规格是否定义了竞争UI元素的视觉层次?"[清晰度]

   **项目结构**:
   每个项目应遵循以下模式:
   - 询问需求质量的问题格式
   - 关注规格/计划中写了什么(或没写什么)
   - 在括号中包含质量维度[完整性/清晰度/一致性/等]
   - 检查现有需求时引用规格部分`[Spec §X.Y]`
   - 检查缺失需求时使用`[Gap]`标记

   **按质量维度的示例**:

   完整性:
   - "是否为所有API失败模式定义了错误处理需求?[Gap]"
   - "是否为所有交互元素指定了无障碍需求?[完整性]"
   - "是否为响应式布局定义了移动端断点需求?[Gap]"

   清晰度:
   - "'快速加载'是否用具体的时间阈值进行了量化?[清晰度,Spec §NFR-2]"
   - "'相关剧集'的选择标准是否明确定义?[清晰度,Spec §FR-5]"
   - "'突出'是否用可衡量的视觉属性定义?[歧义,Spec §FR-4]"

   一致性:
   - "导航需求在所有页面上是否一致?[一致性,Spec §FR-10]"
   - "卡片组件需求在登陆页面和详细页面之间是否一致?[一致性]"

   覆盖范围:
   - "是否为零状态场景(无剧集)定义了需求?[覆盖范围,边界情况]"
   - "是否涵盖了并发用户交互场景?[覆盖范围,Gap]"
   - "是否为部分数据加载失败指定了需求?[覆盖范围,异常流程]"

   可衡量性:
   - "视觉层次需求是否可衡量/可测试?[验收标准,Spec §FR-1]"
   - "'平衡的视觉权重'是否可以客观验证?[可衡量性,Spec §FR-2]"

   **场景分类和覆盖范围**(需求质量焦点):
   - 检查是否存在以下需求:主要、备选、异常/错误、恢复、非功能场景
   - 对于每个场景类别,询问:"[场景类型]需求是否完整、清晰且一致?"
   - 如果缺少场景类别:"[场景类型]需求是有意排除还是缺失?[Gap]"
   - 当发生状态变更时包括弹性/回滚:"是否为迁移失败定义了回滚需求?[Gap]"

   **可追溯性需求**:
   - 最低要求:≥80%的项目必须包含至少一个可追溯性引用
   - 每个项目应引用:规格部分`[Spec §X.Y]`,或使用标记:`[Gap]`、`[Ambiguity]`、`[Conflict]`、`[Assumption]`
   - 如果不存在ID系统:"是否建立了需求和验收标准ID方案?[可追溯性]"

   **发现和解决问题**(需求质量问题):
   询问关于需求本身的问题:
   - 歧义:"术语'快速'是否用具体指标量化?[歧义,Spec §NFR-1]"
   - 冲突:"导航需求在§FR-10和§FR-10a之间是否冲突?[冲突]"
   - 假设:"'始终可用的播客API'假设是否已验证?[假设]"
   - 依赖项:"是否记录了外部播客API需求?[依赖项,Gap]"
   - 缺失定义:"'视觉层次'是否用可衡量的标准定义?[Gap]"

   **内容整合**:
   - 软上限:如果原始候选项目>40,按风险/影响优先排序
   - 合并检查相同需求方面的近似重复项
   - 如果>5个低影响边界情况,创建一个项目:"需求中是否涵盖了边界情况X、Y、Z?[覆盖范围]"

   **🚫 绝对禁止** - 这些使它成为实现测试,而不是需求测试:
   - ❌ 任何以"验证"、"测试"、"确认"、"检查" + 实现行为开头的项目
   - ❌ 引用代码执行、用户操作、系统行为
   - ❌ "正确显示"、"正常工作"、"按预期运行"
   - ❌ "点击"、"导航"、"渲染"、"加载"、"执行"
   - ❌ 测试用例、测试计划、QA程序
   - ❌ 实现细节(框架、API、算法)

   **✅ 必需模式** - 这些测试需求质量:
   - ✅ "是否为[场景]定义/指定/记录了[需求类型]?"
   - ✅ "[模糊术语]是否用具体标准量化/澄清?"
   - ✅ "[A部分]和[B部分]之间的需求是否一致?"
   - ✅ "[需求]是否可以客观衡量/验证?"
   - ✅ "需求中是否涵盖了[边界情况/场景]?"
   - ✅ "规格是否定义了[缺失方面]?"

6. **结构参考**:按照`.specify/templates/checklist-template.md`中的规范模板生成检查清单,包括标题、元数据部分、类别标题和ID格式。如果模板不可用,使用:H1标题、目的/创建的元数据行、包含`- [ ] CHK### <需求项目>`行的`##`类别部分,ID从CHK001开始全局递增。

7. **报告**:输出创建的检查清单的完整路径、项目计数,并提醒用户每次运行都会创建一个新文件。总结:
   - 选择的焦点区域
   - 深度级别
   - 参与者/时间
   - 纳入的任何明确的用户指定必备项目

**重要**:每次`/speckit.checklist`命令调用都使用简短的描述性名称创建检查清单文件,除非文件已存在。这允许:

- 不同类型的多个检查清单(例如,`ux.md`、`test.md`、`security.md`)
- 简单、易记的文件名,指示检查清单目的
- 在`checklists/`文件夹中轻松识别和导航

为避免混乱,使用描述性类型并在完成后清理过时的检查清单。

## 检查清单类型示例和样本项目

**UX需求质量:** `ux.md`

样本项目(测试需求,而不是实现):

- "是否用可衡量的标准定义了视觉层次需求?[清晰度,Spec §FR-1]"
- "UI元素的数量和定位是否明确指定?[完整性,Spec §FR-1]"
- "交互状态需求(悬停、焦点、活动)是否一致定义?[一致性]"
- "是否为所有交互元素指定了无障碍需求?[覆盖范围,Gap]"
- "是否定义了图片加载失败时的回退行为?[边界情况,Gap]"
- "'突出显示'是否可以客观衡量?[可衡量性,Spec §FR-4]"

**API需求质量:** `api.md`

样本项目:

- "是否为所有失败场景指定了错误响应格式?[完整性]"
- "是否用具体阈值量化了速率限制需求?[清晰度]"
- "所有端点的身份验证需求是否一致?[一致性]"
- "是否为外部依赖项定义了重试/超时需求?[覆盖范围,Gap]"
- "需求中是否记录了版本控制策略?[Gap]"

**性能需求质量:** `performance.md`

样本项目:

- "是否用具体指标量化了性能需求?[清晰度]"
- "是否为所有关键用户旅程定义了性能目标?[覆盖范围]"
- "是否指定了不同负载条件下的性能需求?[完整性]"
- "性能需求是否可以客观衡量?[可衡量性]"
- "是否为高负载场景定义了降级需求?[边界情况,Gap]"

**安全需求质量:** `security.md`

样本项目:

- "是否为所有受保护资源指定了身份验证需求?[覆盖范围]"
- "是否为敏感信息定义了数据保护需求?[完整性]"
- "是否记录了威胁模型并使需求与之保持一致?[可追溯性]"
- "安全需求是否与合规义务一致?[一致性]"
- "是否定义了安全失败/违规响应需求?[Gap,异常流程]"

## 反例:不要做什么

**❌ 错误 - 这些测试实现,而不是需求:**

```markdown
- [ ] CHK001 - 验证登陆页面显示3个剧集卡片[Spec §FR-001]
- [ ] CHK002 - 测试桌面上的悬停状态是否正常工作[Spec §FR-003]
- [ ] CHK003 - 确认logo点击导航到主页[Spec §FR-010]
- [ ] CHK004 - 检查相关剧集部分显示3-5个项目[Spec §FR-005]
```

**✅ 正确 - 这些测试需求质量:**

```markdown
- [ ] CHK001 - 是否明确指定了精选剧集的数量和布局?[完整性,Spec §FR-001]
- [ ] CHK002 - 所有交互元素的悬停状态需求是否一致定义?[一致性,Spec §FR-003]
- [ ] CHK003 - 所有可点击品牌元素的导航需求是否清晰?[清晰度,Spec §FR-010]
- [ ] CHK004 - 是否记录了相关剧集的选择标准?[Gap,Spec §FR-005]
- [ ] CHK005 - 是否为异步剧集数据定义了加载状态需求?[Gap]
- [ ] CHK006 - "视觉层次"需求是否可以客观衡量?[可衡量性,Spec §FR-001]
```

**关键差异:**

- 错误:测试系统是否正常工作
- 正确:测试需求是否编写正确
- 错误:行为验证
- 正确:需求质量验证
- 错误:"它是否执行X?"
- 正确:"X是否明确指定?"

