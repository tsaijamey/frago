---
description: 从交互式或提供的原则输入创建或更新项目宪章,确保所有依赖模板保持同步。
handoffs: 
   - label: 构建规范
      agent: speckit.specify
      prompt: 基于更新的宪章实施功能规范。我想要构建...
---

## 用户输入

```text
$ARGUMENTS
```

在继续之前,您**必须**考虑用户输入(如果不为空)。你应该全程使用中文来撰写所有文档内容或代码注释。

## 概述

您正在更新位于 `.specify/memory/constitution.md` 的项目宪章。该文件是一个**模板**,包含方括号中的占位符标记(例如 `[PROJECT_NAME]`、`[PRINCIPLE_1_NAME]`)。您的工作是 (a) 收集/推导具体值,(b) 精确填充模板,以及 (c) 将任何修改传播到依赖的产物中。

遵循以下执行流程:

1. 加载位于 `.specify/memory/constitution.md` 的现有宪章模板。
    - 识别所有形式为 `[ALL_CAPS_IDENTIFIER]` 的占位符标记。
    **重要提示**:用户可能需要比模板中使用的更少或更多的原则。如果指定了数量,请尊重该数量 - 遵循通用模板。您将相应地更新文档。

2. 收集/推导占位符的值:
    - 如果用户输入(对话)提供了值,则使用它。
    - 否则从现有仓库上下文推断(README、文档、先前的宪章版本(如果嵌入))。
    - 对于治理日期:`RATIFICATION_DATE` 是原始采纳日期(如果未知则询问或标记 TODO),`LAST_AMENDED_DATE` 是今天(如果进行了更改),否则保留先前的日期。
    - `CONSTITUTION_VERSION` 必须根据语义化版本规则递增:
       - MAJOR(主版本):向后不兼容的治理/原则删除或重新定义。
       - MINOR(次版本):添加新原则/章节或实质性扩展的指导。
       - PATCH(补丁版本):澄清、措辞、错别字修复、非语义改进。
    - 如果版本升级类型不明确,在最终确定前提出理由。

3. 起草更新的宪章内容:
    - 用具体文本替换每个占位符(除了项目选择暂不定义的有意保留的模板槽外,不留任何括号标记 — 明确说明任何保留的理由)。
    - 保留标题层次结构,一旦替换,注释可以删除,除非它们仍然添加澄清性指导。
    - 确保每个原则部分:简洁的名称行、段落(或项目符号列表)捕获不可协商的规则、明确的理由(如果不明显)。
    - 确保治理部分列出修订程序、版本控制策略和合规性审查期望。

4. 一致性传播检查清单(将先前的检查清单转换为主动验证):
    - 读取 `.specify/templates/plan-template.md` 并确保任何"宪章检查"或规则与更新的原则保持一致。
    - 读取 `.specify/templates/spec-template.md` 以确保范围/需求对齐 — 如果宪章添加/删除强制性部分或约束,则更新。
    - 读取 `.specify/templates/tasks-template.md` 并确保任务分类反映新的或删除的原则驱动任务类型(例如,可观察性、版本控制、测试纪律)。
    - 读取 `.specify/templates/commands/*.md` 中的每个命令文件(包括此文件)以验证在需要通用指导时不再存在过时的引用(仅特定于代理的名称,如 CLAUDE)。
    - 读取任何运行时指导文档(例如,`README.md`、`docs/quickstart.md` 或特定于代理的指导文件(如果存在))。更新对已更改原则的引用。

5. 生成同步影响报告(更新后在宪章文件顶部作为 HTML 注释添加):
    - 版本变更:旧版本 → 新版本
    - 修改的原则列表(如果重命名,旧标题 → 新标题)
    - 添加的章节
    - 删除的章节
    - 需要更新的模板(✅ 已更新 / ⚠ 待处理)及文件路径
    - 后续待办事项(如果有任何占位符被有意推迟)。

6. 最终输出前的验证:
    - 没有剩余的未解释的括号标记。
    - 版本行与报告匹配。
    - 日期采用 ISO 格式 YYYY-MM-DD。
    - 原则是声明性的、可测试的,没有模糊语言("应该" → 在适当的地方用 MUST/SHOULD 理由替换)。

7. 将完成的宪章写回 `.specify/memory/constitution.md`(覆盖)。

8. 向用户输出最终摘要:
    - 新版本和升级理由。
    - 标记为需要手动跟进的任何文件。
    - 建议的提交消息(例如,`docs: amend constitution to vX.Y.Z (principle additions + governance update)`)。

格式和样式要求:

- 完全按照模板中的 Markdown 标题使用(不要降级/升级级别)。
- 换行长的理由行以保持可读性(理想情况下 <100 字符),但不要用尴尬的断行硬性强制执行。
- 在章节之间保留一个空行。
- 避免尾随空格。

如果用户提供部分更新(例如,仅一个原则修订),仍执行验证和版本决策步骤。

如果缺少关键信息(例如,批准日期确实未知),插入 `TODO(<FIELD_NAME>): explanation` 并在同步影响报告的延期项目下包含。

不要创建新模板;始终操作现有的 `.specify/memory/constitution.md` 文件。

